Debian & ArchLinuxARM on Iomega® Home Media Network Hard Drive, Cloud Edition

Stage-1 Bootloader: Iomega original;
U-Boot: Recomplile and support boot from /dev/sda1(u-boot.sd.wrapped) or /dev/md0(u-boot.md.wrapped);
U-Boot environment: Iomega original(u-boot.md.env) and Modified from Iomega original(u-boot.sd.env);
uImage kernel: Recomplile, Base on https://github.com/seidler2547/kernel-oxnas820;
uImage initrd: Initramfs, Base on https://github.com/seidler2547/omv-arm, Modified: Priority to boot from /dev/sdb1; Need to press reset button to execute script recovery.sh;

Debian rootfs: Generated by debootstrap and apt-get;
ArchLinuxARM rootfs: Base on http://archlinuxarm.org/os/ArchLinuxARM-oxnas-latest.tar.gz(http://us.mirror.archlinuxarm.org/os/oxnas/ArchLinuxARM-2012.07-oxnas-rootfs.tar.gz);

FileName	MD5 checksums:
BootSectors.tgz	ca7dba02fa4cfdbaa9266628b8119ef8
Debian.tgz	67641b5877e7bd42b2541c50493e58e3
ArchLinuxARM.tgz	319cbac0f3a1958fdf234999f98e32f7

FileName	SHA1 checksums:
BootSectors.tgz	52129bf3f981456642fba0b951ebb71f2a58d886
Debian.tgz	30410f4fd576dd62657d5b33790617da1a626945
ArchLinuxARM.tgz	1f2e4a0bcf382f40f3833ddea8cd3e8a573efdc7

FileName	CRC32 checksums:
BootSectors.tgz	3f8ac4a4
Debian.tgz	5e234104
ArchLinuxARM.tgz	843c93d0

FileName	SHA-256 checksums:
BootSectors.tgz	9b7f0c6e11e5f9def9a0f3ddbc53b2701ac83ca508212a7e7ec9b5570b189b9e
Debian.tgz	802727423a88d5f89b655906adb3209c7af5aa674fdf85178b7257fc2322ae81
ArchLinuxARM.tgz	d031f41960bd7b796326889e3511ff0fe1f4b06a5c0baed91690b287bc5d4fc6

FileName	SHA-512 checksums:
BootSectors.tgz	ea61ed875ba11f95aa02bae90eb916f77a5c97b33aedf640e29f7d2ee5df2ef7cd03afb39c79e12ebd705c8b7db46e53ac5f09fcb6509d89f38075561a8ec9b5
Debian.tgz	cc214452d5688d83be5fa3d2f22ce28d6eaefaee32fb0388f00df5fc2c3208375c29a58c786d0f56aac4e45cc0518d5c67a7c89e07463b187aa42db5c19a9a12
ArchLinuxARM.tgz	67a6400c0da574a7778805e3a8f54accb16e1780ba647ac1039db81dd7ef846ba85fafba9272bcb85a189896c42a46969ac2f9d45cacb4d8a84f7b33d4646c8d

FileName	SHA-384 checksums:
BootSectors.tgz	1919ce57c9cb90fd4700106979bf80378e8350e8a9e5f7c04618e9defbd60cc0e563e2a3022d1a4f5c811b95de2d7dbc
Debian.tgz	918943c9fd9add26320d7eb61ef0a8a012ae7c05ff882268ab643983a9c99182f18250e54e85758b1935d2106d8e1d69
ArchLinuxARM.tgz	b67a5d6fd89420b2d96479de3d40c4de237c53f10e16a8d2e455b08bfe573059ac04bca671b6b0abd03834b89b4818db


Howto: Update from Iomega® Home Media Network Hard Drive, Cloud Edition original firmware:

Warning:

By doing anything that follows, you could:
	Brick your device
	Loose all data on you device
	Void your warranty
or any combination of the above. So don't proceed unless you know what you're doing and you mean it.

Prerequisites:

You will need
	A USB memory stick (alway support USB Disk & USB Cardreader) of at least 1GB space on it first partition(All data on this partition will loose);
	Your device has normal boot from original firmware or other linux system;
	Enabled ssh access to your device;
	A network router with DHCP enabled (it usually is) and the device connected to it (otherwise you won't be able to access the device);
	[option]:Access to the serial console of the device, although not strictly necessary, is helpful because otherwise you'll have no clue what's going on if it doesn't work (more information, but basically what you need is a 3.3V UART-USB adapter);
	[option]:Reasonable knowledge of Linux;

Procedure:

	Power up the device and normal boot up;
	Plug the stick into one of the USB ports of the device;
	Unmount the USB stick and format;
		command: 
			unmount /dev/sdb1 && mkfs.ext3 /dev/sdb1
		or if not need umount:
			mkfs.ext3 /dev/sdb1
	Download rootfs file(Debian.tgz or ArchLinuxARM.tgz) and upload to your device's /boot directory;
	Mount the USB stick and extract rootfs;
		command:
			mkdir /tmp/usb
			mount /dev/sdb1 /tmp/usb
			cd /boot
			tar -C /tmp/usb -zxf Debian.tgz #[or archlinux: tar -C /tmp/usb -zxvf ArchLinuxARM.tgz]
	Create a sign of bootable system on USB stick and sync;
		command:
			touch /tmp/usb/boot.from.here
			sync
	Write boot sectors data to inner HDD;
		command:
			cd /tmp/usb/boot
			./flushsd.sh /dev/sda
	Copy rootfs file to USB stick;
		command:
			cp /boot/Debian.tgz /tmp/usb/root/Debian.tgz #[or archlinux: cp /boot/ArchLinuxARM.tgz /tmp/usb/root/ArchLinuxARM.tgz]
			sync
	Reboot your device; Don't pull the USB stick from the device, the device will boot up and use the stick's first partition as rootfs;
		command:
			reboot
	When device loading USB stick's first partition as rootfs, both white LEDs on the front blink and red LED turn on;
	After device boot succeed, red LED on the front turn off and white LEDs stop blink(one turn off and one turn on);
	Now, Login your device as root with the password root through SSH client;
	Destroy inner HDD's raid system;
		command:
			lvchange -a n md0_vg
			mdadm --stop --scan
			mdadm --zero-superblock /dev/sda1
	Create new partition table and filesystem on inner HDD(default rootfs partition size:20GB);
		command:
			cd /boot
			./mkgptdisk.sh /dev/sda #[if you want msdos part, command: ./mkdosdisk.sh /dev/sda]
	Mount inner HDD and extract rootfs to it;
		command:
			mkdir /tmp/mydisk
			mount /dev/sda1 /tmp/mydisk
			cd /root
			tar -C /tmp/mydisk -zvxf Debian.tgz #[or archlinux: tar -C /tmp/mydisk -zvxf ArchLinuxARM.tgz]
			sync
	Rewrite boot sectors data to inner HDD;
		command:
			cd /boot
			./flushsd.sh /dev/sda
	Create second partition (user data partition) on inner HDD and format it;
		command:
			parted /dev/sda mkpart primary 21.5GB 2TB
			mkfs.ext3 /dev/sda2
	Delete the sign of bootable system on USB stick and reboot;
		command:
			rm /boot.from.here
			sync
			reboot
	Ok, Your device will normal boot to the Debian [or ArchLinuxARM] system and use inner HDD's first partition as rootfs;
